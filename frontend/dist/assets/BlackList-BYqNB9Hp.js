import{r as x,j as e,a as f}from"./index-DYyG9tY2.js";import{S as u}from"./Stack-tNIQgHZk.js";import{C as w,a as C,B as k}from"./Grow-DRnYveo1.js";import{B as L,T as h,P}from"./Box-BkwbmR-T.js";import{b as y,c as B,d as m,e as l,f as r,g as v}from"./Dashboard-D909kwKG.js";import{C as W}from"./Checkbox-DTp8gSj8.js";import"./mergeSlotProps-BsSwRAHX.js";const a={BLACKLIST:"blacklist",WHITELIST:"whitelist"},E=i=>i?new Date(i*1e3).toLocaleString():"-";function F(){const[i,o]=x.useState([]),[c,p]=x.useState(new Set),[S,b]=x.useState(null),T=async()=>{try{const s=(await f.getProtection()).map(n=>({...n,status:a.BLACKLIST,isSelected:c.has(n.ip)}));o(s),b(null)}catch(t){b("제한 목록을 불러오는 중 오류가 발생했습니다."),console.error("BlackList fetch error:",t)}},g=t=>{p(s=>{const n=new Set(s);return n.has(t)?n.delete(t):n.add(t),n}),o(s=>s.map(n=>n.ip===t?{...n,isSelected:!n.isSelected}:n))},A=async()=>{const t=i.filter(s=>c.has(s.ip)&&s.status===a.BLACKLIST);if(t.length===0){alert("선택된 ip가 존재하지 않습니다.");return}try{for(const s of t)await f.unblockIP(s.ip),p(n=>{const d=new Set(n);return d.delete(s.ip),d});o(s=>s.map(n=>c.has(n.ip)&&n.status===a.BLACKLIST?{...n,status:a.WHITELIST,isSelected:!1}:n))}catch(s){console.error("IP 허용 오류",s),alert("IP 허용 중 오류가 발생했습니다.")}},H=async()=>{const t=i.filter(s=>c.has(s.ip)&&s.status===a.WHITELIST);if(t.length===0){alert("선택된 ip가 존재하지 않습니다.");return}try{for(const s of t)await f.blockIP(s.ip),p(n=>{const d=new Set(n);return d.delete(s.ip),d});o(s=>s.map(n=>c.has(n.ip)&&n.status===a.WHITELIST?{...n,status:a.BLACKLIST,isSelected:!1}:n))}catch(s){console.error("IP 차단 오류",s),alert("IP 차단 중 오류가 발생했습니다.")}};x.useEffect(()=>{T();const t=setInterval(T,5e3);return()=>clearInterval(t)},[]);const j=i.filter(t=>t.status===a.BLACKLIST),I=i.filter(t=>t.status===a.WHITELIST),K=j.filter(t=>c.has(t.ip)).length,_=I.filter(t=>c.has(t.ip)).length;return e.jsxs(u,{spacing:3,children:[e.jsx(w,{children:e.jsxs(C,{children:[e.jsxs(L,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(h,{variant:"h6",gutterBottom:!0,children:"차단 IP 목록 (IP BlackList)"}),e.jsx(u,{direction:"row",spacing:2,children:e.jsx(k,{variant:"contained",color:"success",onClick:()=>A(),disabled:K===0,children:"허용"})})]}),e.jsx(y,{component:P,sx:{overflowY:"auto"},children:e.jsxs(B,{children:[e.jsx(m,{children:e.jsxs(l,{children:[e.jsx(r,{padding:"checkbox"}),e.jsx(r,{sx:{fontWeight:"bold"},children:"IP"}),e.jsx(r,{sx:{fontWeight:"bold"},children:"차단된 시각"})]})}),e.jsx(v,{children:S?e.jsx(l,{children:e.jsx(r,{colSpan:2,align:"center",children:e.jsx(h,{color:"error",variant:"body1",children:S})})}):j.length===0?e.jsx(l,{children:e.jsx(r,{colSpan:2,align:"center",children:e.jsx(h,{color:"textSecondary",variant:"body1",children:"차단된 IP가 존재하지 않습니다."})})}):j.map((t,s)=>e.jsxs(l,{selected:c.has(t.ip),children:[e.jsx(r,{padding:"checkbox",children:e.jsx(W,{checked:c.has(t.ip),onChange:()=>g(t.ip)})}),e.jsx(r,{children:t.ip}),e.jsx(r,{children:E(t.expire_at)})]},t.ip))})]})})]})}),e.jsx(w,{children:e.jsxs(C,{children:[e.jsxs(L,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(h,{variant:"h6",gutterBottom:!0,children:"허용 IP 목록 (IP WhiteList)"}),e.jsx(u,{direction:"row",spacing:2,children:e.jsx(k,{variant:"contained",color:"success",onClick:()=>H(),disabled:_===0,children:"차단"})})]}),e.jsx(y,{component:P,sx:{overflowY:"auto"},children:e.jsxs(B,{children:[e.jsx(m,{children:e.jsxs(l,{children:[e.jsx(r,{padding:"checkbox"}),e.jsx(r,{sx:{fontWeight:"bold"},children:"IP"}),e.jsx(r,{sx:{fontWeight:"bold"},children:"차단된 시각"})]})}),e.jsx(v,{children:I.length===0?e.jsx(l,{children:e.jsx(r,{colSpan:2,align:"center",children:e.jsx(h,{color:"textSecondary",variant:"body1",children:"허용된 IP가 존재하지 않습니다."})})}):I.map((t,s)=>e.jsxs(l,{selected:c.has(t.ip),children:[e.jsx(r,{padding:"checkbox",children:e.jsx(W,{checked:c.has(t.ip),onChange:()=>g(t.ip)})}),e.jsx(r,{children:t.ip}),e.jsx(r,{children:E(t.expire_at)})]},t.ip))})]})})]})})]})}export{F as default};
