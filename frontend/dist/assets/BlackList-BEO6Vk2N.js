import{r as p,j as e,a as o}from"./index-nMGsR3c-.js";import{S}from"./Stack-BTMEGT6E.js";import{C as T,a as k,B as P}from"./Grow-CEzWOBxN.js";import{B as L,T as h,P as y}from"./Box-BCcqsBsd.js";import{b as C,c as B,d as W,e as l,f as r,g as v}from"./Dashboard-twAUemW3.js";import{C as E}from"./Checkbox-DOzkSYF7.js";import"./mergeSlotProps-Fa2-9alf.js";const d={BLACKLIST:"blacklist",WHITELIST:"whitelist"},A=i=>i?new Date(i*1e3).toLocaleString():"-";function M(){const[i,j]=p.useState([]),[a,I]=p.useState(new Set),[m,b]=p.useState(null),x=async()=>{try{const t=await o.getProtection(),s=await o.getWhiteList(),n=t.map(c=>({...c,status:d.BLACKLIST,isSelected:a.has(c.ip)})),U=s.map(c=>{const g=typeof c=="string"?c:c.ip;return{ip:g,expire_at:c.expire_at||null,status:d.WHITELIST,isSelected:a.has(g)}});j([...n,...U]),b(null)}catch(t){b("제한 목록을 불러오는 중 오류가 발생했습니다."),console.error("Protection logs fetch error:",t)}},w=t=>{I(s=>{const n=new Set(s);return n.has(t)?n.delete(t):n.add(t),n}),j(s=>s.map(n=>n.ip===t?{...n,isSelected:!n.isSelected}:n))},H=async()=>{const t=i.filter(s=>a.has(s.ip)&&s.status===d.BLACKLIST).map(s=>s.ip);if(t.length===0){alert("허용할 IP가 선택되지 않았습니다.");return}try{for(const s of t)await o.addWhiteList(s),await o.unblockIP(s);await x(),I(new Set)}catch(s){console.error("IP 허용 오류",s),alert("IP 허용 중 오류가 발생했습니다.")}},_=async()=>{const t=i.filter(s=>a.has(s.ip)&&s.status===d.WHITELIST).map(s=>s.ip);if(t.length===0){alert("차단할 IP가 선택되지 않았습니다.");return}try{for(const s of t)await o.blockIP(s),await o.removeWhiteList(s);await x(),I(new Set)}catch(s){console.error("IP 차단 오류",s),alert("IP 차단 중 오류가 발생했습니다.")}};p.useEffect(()=>{x();const t=setInterval(x,5e3);return()=>clearInterval(t)},[]);const f=i.filter(t=>t.status===d.BLACKLIST),u=i.filter(t=>t.status===d.WHITELIST),K=f.filter(t=>a.has(t.ip)).length,R=u.filter(t=>a.has(t.ip)).length;return e.jsxs(S,{spacing:3,children:[e.jsx(T,{children:e.jsxs(k,{children:[e.jsxs(L,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(h,{variant:"h6",gutterBottom:!0,children:"차단 IP 목록 (IP BlackList)"}),e.jsx(S,{direction:"row",spacing:2,children:e.jsx(P,{variant:"contained",color:"success",onClick:H,disabled:K===0,children:"허용"})})]}),e.jsx(C,{component:y,sx:{overflowY:"auto"},children:e.jsxs(B,{children:[e.jsx(W,{children:e.jsxs(l,{children:[e.jsx(r,{padding:"checkbox"}),e.jsx(r,{sx:{fontWeight:"bold"},children:"IP"}),e.jsx(r,{sx:{fontWeight:"bold"},children:"차단된 시각"})]})}),e.jsx(v,{children:m?e.jsx(l,{children:e.jsx(r,{colSpan:3,align:"center",children:e.jsx(h,{color:"error",variant:"body1",children:m})})}):f.length===0?e.jsx(l,{children:e.jsx(r,{colSpan:3,align:"center",children:e.jsx(h,{color:"textSecondary",variant:"body1",children:"차단된 IP가 존재하지 않습니다."})})}):f.map(t=>e.jsxs(l,{selected:a.has(t.ip),children:[e.jsx(r,{padding:"checkbox",children:e.jsx(E,{checked:a.has(t.ip),onChange:()=>w(t.ip)})}),e.jsx(r,{children:t.ip}),e.jsx(r,{children:A(t.expire_at)})]},t.ip))})]})})]})}),e.jsx(T,{children:e.jsxs(k,{children:[e.jsxs(L,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(h,{variant:"h6",gutterBottom:!0,children:"허용 IP 목록 (IP WhiteList)"}),e.jsx(S,{direction:"row",spacing:2,children:e.jsx(P,{variant:"contained",color:"error",onClick:_,disabled:R===0,children:"차단"})})]}),e.jsx(C,{component:y,sx:{overflowY:"auto"},children:e.jsxs(B,{children:[e.jsx(W,{children:e.jsxs(l,{children:[e.jsx(r,{padding:"checkbox"}),e.jsx(r,{sx:{fontWeight:"bold"},children:"IP"}),e.jsx(r,{sx:{fontWeight:"bold"},children:"추가된 시각"})]})}),e.jsx(v,{children:u.length===0?e.jsx(l,{children:e.jsx(r,{colSpan:3,align:"center",children:e.jsx(h,{color:"textSecondary",variant:"body1",children:"허용된 IP가 존재하지 않습니다."})})}):u.map(t=>e.jsxs(l,{selected:a.has(t.ip),children:[e.jsx(r,{padding:"checkbox",children:e.jsx(E,{checked:a.has(t.ip),onChange:()=>w(t.ip)})}),e.jsx(r,{children:t.ip}),e.jsx(r,{children:A(t.added_at)||"-"})]},t.ip))})]})})]})})]})}export{M as default};
